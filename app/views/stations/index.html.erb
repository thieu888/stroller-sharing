<div class="container py-4">
  <div class="row mb-4">
    <div class="col-12">
      <h1 class="display-5 fw-bold text-primary mb-3">
        <i class="fas fa-map-marked-alt me-3"></i>Stations disponibles
      </h1>
      <p class="lead text-muted">Trouvez la station la plus proche de vous et réservez votre poussette</p>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-12">
      <div class="card border-0 shadow-sm">
        <div class="card-body">
          <div class="row text-center">
            <div class="col-md-4">
              <h3 class="text-primary fw-bold"><%= @stations.count %></h3>
              <p class="text-muted mb-0">Stations actives</p>
            </div>
            <div class="col-md-4">
              <h3 class="text-success fw-bold">
                <%= @stations.joins(:strollers).where(strollers: { status: 'available' }).count %>
              </h3>
              <p class="text-muted mb-0">Poussettes disponibles</p>
            </div>
            <div class="col-md-4">
              <h3 class="text-info fw-bold">
                <%= @stations.sum(:capacity) %>
              </h3>
              <p class="text-muted mb-0">Capacité totale</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <% @stations.each do |station| %>
      <div class="col-md-6 col-lg-4 mb-4">
        <div class="card h-100 border-0 shadow-sm hover-card">
          <div class="card-body d-flex flex-column">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <h5 class="card-title text-primary fw-bold mb-0"><%= station.name %></h5>
              <% available_count = station.strollers.where(status: 'available').count %>
              <% if available_count > 0 %>
                <span class="badge bg-success"><%= available_count %> disponible<%= 's' if available_count > 1 %></span>
              <% else %>
                <span class="badge bg-danger">Aucune disponible</span>
              <% end %>
            </div>

            <div class="mb-3">
              <p class="text-muted mb-2">
                <i class="fas fa-map-marker-alt text-danger me-2"></i>
                <%= number_with_precision(station.gps_lat, precision: 4) %>, 
                <%= number_with_precision(station.gps_lng, precision: 4) %>
              </p>
              
              <div class="d-flex justify-content-between text-sm">
                <span class="text-muted">
                  <i class="fas fa-baby-carriage me-1"></i>
                  <%= station.strollers.count %>/<%= station.capacity %>
                </span>
                <span class="text-muted">
                  <i class="fas fa-battery-three-quarters me-1"></i>
                  <%= station.strollers.where('battery_level > 20').count %> chargées
                </span>
              </div>
            </div>

            <div class="mt-auto">
              <div class="progress mb-3" style="height: 8px;">
                <% occupancy = (station.strollers.count.to_f / station.capacity * 100).round %>
                <div class="progress-bar 
                  <%= occupancy > 80 ? 'bg-danger' : occupancy > 50 ? 'bg-warning' : 'bg-success' %>" 
                  style="width: <%= occupancy %>%">
                </div>
              </div>
              
              <div class="d-flex gap-2">
                <%= link_to station_path(station), class: "btn btn-primary flex-fill" do %>
                  <i class="fas fa-eye me-1"></i> Voir détails
                <% end %>
                <% if available_count > 0 %>
                  <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#reserveModal<%= station.id %>">
                    <i class="fas fa-book me-1"></i> Réserver
                  </button>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal de réservation -->
      <div class="modal fade" id="reserveModal<%= station.id %>" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Réserver à <%= station.name %></h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <p>Fonctionnalité de réservation à venir...</p>
              <p class="text-muted">Poussettes disponibles: <%= available_count %></p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
              <button type="button" class="btn btn-primary">Confirmer la réservation</button>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>

<style>
  .hover-card {
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
  }
  
  .hover-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
  }
</style>
